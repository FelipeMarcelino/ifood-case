2025-09-25 20:18:27,932 - ifood_case.data_processing - INFO - DataProcessing class initialize
2025-09-25 20:52:26,087 - ifood_case.data_processing - INFO - DataProcessing class initialize
2025-09-25 20:52:26,102 - ifood_case.data_processing - INFO - Starting data processing transformation pipeline...
2025-09-25 20:52:26,103 - ifood_case.data_processing - INFO - Restructuring transactions: flattening 'value' column.
2025-09-25 20:52:26,148 - ifood_case.data_processing - INFO - Creating 'age_group' feature in profile DataFrame.
2025-09-25 20:52:26,179 - ifood_case.data_processing - INFO - Joining processed dataframes...
2025-09-25 20:52:28,305 - ifood_case.data_processing - INFO - Final Joined dataframe has 306534 rows 
2025-09-25 20:52:28,306 - ifood_case.data_processing - INFO - Data processing transformation pipeline finished
2025-09-25 20:52:28,320 - ifood_case.data_visualizer - INFO - DataVisualizer class initialized.
2025-09-25 20:52:28,332 - ifood_case.data_visualizer - INFO - Generating bar plots for marketing channels.
2025-09-25 20:52:29,429 - ifood_case.data_visualizer - INFO - Generating histogram for age distribution.
2025-09-25 20:52:29,692 - ifood_case.data_visualizer - INFO - Generating histogram for credit card limit distribution.
2025-09-25 20:52:29,932 - ifood_case.data_visualizer - INFO - Generating bar plot for gender distribution.
2025-09-25 20:52:30,242 - ifood_case.data_visualizer - INFO - Generating bar plot for event type distribution.
2025-09-25 20:52:31,011 - ifood_case.data_visualizer - INFO - Generating histogram for credit card limit, segmented by age group.
2025-09-25 20:52:31,509 - ifood_case.data_visualizer - INFO - Generating histogram for credit card limit, segmented by gender.
2025-09-25 20:52:31,894 - ifood_case.data_visualizer - INFO - Generating plot for offer effectiveness by customer profile.
2025-09-25 20:52:34,046 - ifood_case.data_visualizer - INFO - Generating plot for conversion rate by marketing channel.
2025-09-25 20:52:35,834 - ifood_case.data_visualizer - INFO - Generating plot for transaction value by offer usage.
2025-09-25 20:52:38,824 - ifood_case.data_visualizer - INFO - Generating plot for the impact of informational offers.
2025-09-25 20:52:41,012 - ifood_case.data_visualizer - INFO - Generating time-series plot for offer engagement by profile.
2025-09-25 20:57:27,388 - ifood_case.feature_engineering - INFO - Feature Engineering class initialized
2025-09-25 20:57:27,404 - ifood_case.feature_engineering - INFO - Starting feature engineering pipeline...
2025-09-25 20:57:27,405 - ifood_case.feature_engineering - INFO - Creating target variable...
2025-09-25 20:57:30,537 - ifood_case.feature_engineering - INFO - Target variable created with 76277 opportunity rows.
2025-09-25 20:57:30,538 - ifood_case.feature_engineering - INFO - Creating point-in-time behavioral features
2025-09-25 20:57:30,827 - ifood_case.feature_engineering - INFO - Creating 'last offer viewed' feature
2025-09-25 20:57:30,890 - ifood_case.feature_engineering - INFO - Creating profile features (age cleaning, cyclical date)....
2025-09-25 20:57:30,957 - ifood_case.feature_engineering - INFO - Creating static offer features (one hot encoding, ratios)...
2025-09-25 20:57:31,297 - ifood_case.feature_engineering - INFO - Joining all feature sets...
2025-09-25 20:57:34,018 - ifood_case.feature_engineering - INFO - Final feature DataFrame created with 76277 rows and 29 columns.
2025-09-25 20:57:34,019 - ifood_case.utils - INFO - Separating columns by numerical and categorical types...
2025-09-25 20:57:34,020 - ifood_case.utils - INFO - Found 22 numerical and 3 categorical columns.
2025-09-25 20:57:34,020 - ifood_case.feature_engineering - INFO - Found 22 numerical and 3 categorical features.
2025-09-25 20:57:34,021 - ifood_case.feature_engineering - INFO - Feature engineering pipeline completed.
2025-09-25 20:57:34,081 - ifood_case.utils - INFO - Calculating correlation matrix for numerical features...
2025-09-25 20:57:40,187 - ifood_case.utils - INFO - Plotting correlation heatmap...
2025-09-25 20:57:41,104 - ifood_case.model_trainer - INFO - ModelTrainer initialized
2025-09-25 20:57:41,124 - ifood_case.model_trainer - INFO - Starting model training and tuning process...
2025-09-25 20:57:41,125 - ifood_case.model_trainer - INFO - Splitting data into train and test sets based on last customer offer.
2025-09-25 20:57:41,167 - ifood_case.model_trainer - INFO - Converting Spark DataFrames to Pandas.
2025-09-25 20:57:46,904 - ifood_case.model_trainer - INFO - Splitting training data into a training subset and a calibration set.
2025-09-25 20:57:46,926 - ifood_case.model_trainer - INFO - Data split: 47426 train, 11857 calibration, 16994 test samples.
2025-09-25 20:57:46,932 - ifood_case.model_trainer - INFO - Starting OptunaSearchCV for LightGBM with 50 trials...
2025-09-25 21:00:49,588 - ifood_case.model_trainer - INFO - Optuna search complete. Best score (average_precision): 0.8639
2025-09-25 21:00:49,588 - ifood_case.model_trainer - INFO - Starting isotonic calibration step...
2025-09-25 21:00:49,620 - ifood_case.model_trainer - INFO - Calibration complete.
2025-09-25 21:00:49,639 - ifood_case.evaluator - INFO - Evaluator initialized with 16994 test samples.
2025-09-25 21:00:49,756 - ifood_case.evaluator - INFO - Generating full evaluation report...
2025-09-25 21:00:49,770 - ifood_case.evaluator - INFO - Classification report generated.
2025-09-25 21:00:49,771 - ifood_case.evaluator - INFO - Plotting confusion matrix...
2025-09-25 21:00:49,845 - ifood_case.evaluator - INFO - Plotting Precision-Recall curve...
2025-09-25 21:00:49,942 - ifood_case.evaluator - INFO - Plotting ROC Curve...
2025-09-25 21:00:50,132 - ifood_case.utils - INFO - Starting search for optimal financial threshold...
2025-09-25 21:00:50,133 - ifood_case.evaluator - INFO - Calculating financial uplift...
2025-09-25 21:00:50,134 - ifood_case.evaluator - INFO - Financial Uplift Calculated: $4790.23
2025-09-25 21:00:50,135 - ifood_case.evaluator - INFO - Calculating financial uplift...
2025-09-25 21:00:50,137 - ifood_case.evaluator - INFO - Financial Uplift Calculated: $4589.50
2025-09-25 21:00:50,137 - ifood_case.evaluator - INFO - Calculating financial uplift...
2025-09-25 21:00:50,139 - ifood_case.evaluator - INFO - Financial Uplift Calculated: $3899.42
2025-09-25 21:00:50,139 - ifood_case.evaluator - INFO - Calculating financial uplift...
2025-09-25 21:00:50,141 - ifood_case.evaluator - INFO - Financial Uplift Calculated: $2920.53
2025-09-25 21:00:50,141 - ifood_case.evaluator - INFO - Calculating financial uplift...
2025-09-25 21:00:50,143 - ifood_case.evaluator - INFO - Financial Uplift Calculated: $1218.24
2025-09-25 21:00:50,143 - ifood_case.evaluator - INFO - Calculating financial uplift...
2025-09-25 21:00:50,145 - ifood_case.evaluator - INFO - Financial Uplift Calculated: $-1102.36
2025-09-25 21:00:50,145 - ifood_case.evaluator - INFO - Calculating financial uplift...
2025-09-25 21:00:50,147 - ifood_case.evaluator - INFO - Financial Uplift Calculated: $-3103.57
2025-09-25 21:00:50,147 - ifood_case.evaluator - INFO - Calculating financial uplift...
2025-09-25 21:00:50,149 - ifood_case.evaluator - INFO - Financial Uplift Calculated: $-9692.70
2025-09-25 21:00:50,149 - ifood_case.evaluator - INFO - Calculating financial uplift...
2025-09-25 21:00:50,150 - ifood_case.evaluator - INFO - Financial Uplift Calculated: $-9709.57
2025-09-25 21:00:50,151 - ifood_case.evaluator - INFO - Calculating financial uplift...
2025-09-25 21:00:50,153 - ifood_case.evaluator - INFO - Financial Uplift Calculated: $-13454.25
2025-09-25 21:00:50,153 - ifood_case.evaluator - INFO - Calculating financial uplift...
2025-09-25 21:00:50,154 - ifood_case.evaluator - INFO - Financial Uplift Calculated: $-18292.86
2025-09-25 21:00:50,155 - ifood_case.evaluator - INFO - Calculating financial uplift...
2025-09-25 21:00:50,156 - ifood_case.evaluator - INFO - Financial Uplift Calculated: $-27504.34
2025-09-25 21:00:50,157 - ifood_case.evaluator - INFO - Calculating financial uplift...
2025-09-25 21:00:50,159 - ifood_case.evaluator - INFO - Financial Uplift Calculated: $-32643.61
2025-09-25 21:00:50,159 - ifood_case.evaluator - INFO - Calculating financial uplift...
2025-09-25 21:00:50,160 - ifood_case.evaluator - INFO - Financial Uplift Calculated: $-42943.42
2025-09-25 21:00:50,161 - ifood_case.evaluator - INFO - Calculating financial uplift...
2025-09-25 21:00:50,162 - ifood_case.evaluator - INFO - Financial Uplift Calculated: $-42983.15
2025-09-25 21:00:50,163 - ifood_case.evaluator - INFO - Calculating financial uplift...
2025-09-25 21:00:50,164 - ifood_case.evaluator - INFO - Financial Uplift Calculated: $-56609.57
2025-09-25 21:00:50,165 - ifood_case.evaluator - INFO - Calculating financial uplift...
2025-09-25 21:00:50,166 - ifood_case.evaluator - INFO - Financial Uplift Calculated: $-67918.84
2025-09-25 21:00:50,166 - ifood_case.evaluator - INFO - Calculating financial uplift...
2025-09-25 21:00:50,168 - ifood_case.evaluator - INFO - Financial Uplift Calculated: $-98365.12
2025-09-25 21:00:50,168 - ifood_case.evaluator - INFO - Calculating financial uplift...
2025-09-25 21:00:50,170 - ifood_case.evaluator - INFO - Financial Uplift Calculated: $-122473.87
2025-09-25 21:00:50,171 - ifood_case.utils - INFO - --- Threshold vs. Uplift Analysis ---
2025-09-25 21:00:50,173 - ifood_case.utils - INFO - 
    threshold  model_profit  financial_uplift
0        0.05     187333.13           4790.23
1        0.10     187132.40           4589.50
2        0.15     186442.32           3899.42
3        0.20     185463.43           2920.53
4        0.25     183761.14           1218.24
5        0.30     181440.54          -1102.36
6        0.35     179439.33          -3103.57
7        0.40     172850.20          -9692.70
8        0.45     172833.33          -9709.57
9        0.50     169088.65         -13454.25
10       0.55     164250.04         -18292.86
11       0.60     155038.56         -27504.34
12       0.65     149899.29         -32643.61
13       0.70     139599.48         -42943.42
14       0.75     139559.75         -42983.15
15       0.80     125933.33         -56609.57
16       0.85     114624.06         -67918.84
17       0.90      84177.78         -98365.12
18       0.95      60069.03        -122473.87
2025-09-25 21:00:50,174 - ifood_case.utils - INFO - --- Best Threshold Found ---
2025-09-25 21:00:50,174 - ifood_case.utils - INFO - 
threshold                0.05
model_profit        187333.13
financial_uplift      4790.23
Name: 0, dtype: float64
2025-09-25 21:00:50,190 - ifood_case.evaluator - INFO - Starting SHAP summary plot generation...
2025-09-25 21:00:50,191 - ifood_case.evaluator - INFO - Transform test data for SHAP analysis.
2025-09-25 21:00:50,205 - ifood_case.evaluator - INFO - Calculating SHAP values...(this may take a moment)
2025-09-25 21:00:52,331 - ifood_case.evaluator - INFO - Plotting SHAP summary...
